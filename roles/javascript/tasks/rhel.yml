---
- name: "Install prereq dependencies"
  package:
    name: "{{ item }}"
    state: latest
  with_items: "{{ dependencies }}"
  become: yes
  tags:
    - dependency
    - install

- name: "Refresh the Yarn repo"
  get_url:
    url: https://dl.yarnpkg.com/rpm/yarn.repo
    dest: /etc/yum.repos.d/yarn.repo
  become: yes
  tags:
    - package
    - repository

- name: "Ensure installers directory is present"
  file:
    path: "{{ nodesource_src_path | dirname }}"
    state: directory
    owner: root
    group: root
  become: yes
  tags:
    - directory

# - name: "Get latest Node installer"
#   get_url:
#     url: https://rpm.nodesource.com/setup_9.x
#     dest: "{{ root_dir }}/.config/installers/nodesource"
#     mode: "u=rwx,go="
#     owner: "{{ owning_user }}"
#     group: "{{ owning_group }}"
#   register: nodesource_installer

# - name: "Run latest NodeSource installer"
#   command: "bash {{ root_dir }}/.config/installers/nodesource"
#   become: yes
#   when: nodesource_installer|changed

# - name: Update main binaries
#   package:
#     name: "{{ item }}"
#     state: latest
#   become: yes
#   with_items:
#     - nodejs
#     - yarn

